<?php
		include("connectData.php");
		$last_index = 0;
		//index of food of table to show
		$index = (isset($_GET['index'])) ? $_GET['index'] : 0;
		//bill id of show list
		$bill_id = (isset($_GET['bill_id'])) ? $_GET['bill_id'] : -1;
		//food id of list item
		$food_id = (isset($_GET['food_id'])) ? $_GET['food_id'] : -1;
		
		connectdb();		
		if($food_id > -1){
			mysql_query("UPDATE orders SET status = 2 WHERE bill_id = ".$bill_id." AND food_id = ".$food_id);
		}else if($bill_id > -1){
			mysql_query("UPDATE orders SET status = 2 WHERE orders.bill_id = ".$bill_id);
		}
		mysql_close();
		//Get Data from Database
		$orders =GetOrdersByTime();
		//variable list item 
		$listVar = "Danh sách bàn";  //Sort by Time
		//$listVar = "Food "; //Sort by Food 
		
		
		if($orders == null){
			echo "<center style=\"color:#FF0000;\">Not Data</center>";
		}else{
?>
	        <div class="left" style="width:30%; float:left">
				<div id="titleListTable">
                	<?php echo $listVar; ?>
                </div>
                
                <ul style="width: 100%;" data-role="listview" data-inset="false" data-theme="d" data-dividertheme="b"  class="ui-listview">
						<?php 
						$i = 0;
						?>
						<DIV id="TipLayer" style="visibility:hidden;position:absolute;z-index:1000;top:-100"><p align="center"></DIV>
						<?php
						foreach($orders as $item){
						?>
							<li onMouseOver="itemListHover(<?php echo "'".$item[2]."','".$item[4]."'"; ?>)" onMouseOut="htm()" data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="d" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-btn-up-d"><div class="ui-btn-inner ui-li"><div class="ui-btn-text"><a id="<?php echo "item_".$i; ?>" onClick="onClickItemList(<?php echo $i; ?>);" class="ui-link-inherit"><span style="float:left; width: 85px; display: block; overflow: hidden;"><?php echo $item[2];?></span><span style="float: left; max-width: 50%; overflow: hidden;">&nbsp;-&nbsp;-&nbsp;&nbsp;&nbsp;<?php echo $item[4]; ?></span><span style="float: right; width: 25px;">[<span style="color:#D5042E;"><?php echo count($item[3]);?></span>]</span></a></div><span class="ui-icon ui-icon-arrow-r ui-icon-shadow">&nbsp;</span></div></li>
							<div style="clear: both"></div>
						<?php 
						$i++;
						} 
						?>
				</ul>
                
			 </div>	
             <div id="contentRight" class="right" style="width:70%; float:left">
				
				<!-- Content Right -->
                
			 </div>               
                
             
			 
			 
<script type="text/javascript">
	// Storage item count
	var i;
	if(typeof sessionStorage.item_count != 'undefined')
		i = sessionStorage.item_count;
	else
		i = 0;
		
	var items = new Array();
	
	
	//---------------------//
		if(typeof sessionStorage.items != 'undefined'){
			// If only one item then remove all item in array
			if(sessionStorage.item_count == 1)
				sessionStorage.items = JSON.stringify(new Array());
			items = JSON.parse(sessionStorage.items);
		}
		for(; i< <?php echo count($orders); ?>; i++)
			items[items.length] = Number(i);
	//---------------------//
	// Set text color for new order
	for(i=0; i<items.length; i++){
		$("#item_"+items[i]).css('color','#FFBF00');
	}
	
	sessionStorage.items = JSON.stringify(items);
	
	sessionStorage.item_count = <?php echo count($orders); ?>;
	console.log(items);
	// Set text color item selected
	$('#item_'+<?php echo $index;?>).css('color','#04B404');
	sessionStorage.last_index = <?php echo $index;?>;

	$.ajax({
			type: 'POST',
			url: "php/contentRight.php?index="+<?php echo $index;?>,
			data: null,
			success: function(result)
			{
				$('#contentRight').html(result);
			},
			error: {
			}
	});
	function onClickItemList(index){
		sessionStorage.curIndex = index;
		// get Array new items
		var items =  JSON.parse(sessionStorage.items);
		console.log(items);
		console.log(items+ "   "+index+"   "+items.indexOf(index));
		
		while(true){
			var a = items.indexOf(index);
			if(a != -1){
				items.splice(a,1);
			}else{
				break;
			}
		}
		console.log(items);
		// storage Array new items
		sessionStorage.items = JSON.stringify(items);

		$('#item_'+sessionStorage.last_index).css('color','#000');
		$('#item_'+index).css('color','#04B404');
		sessionStorage.last_index = index;
		//alert(foods.length);
			$.ajax({
				type: 'POST',
				url: "php/contentRight.php?index="+index,
				data: null,
				success: function(result)
				{
					$('#contentRight').html(result);
				},
				error: {
				}
			});  
	}
	
	function itemListHover(firstRow, secondRow){
		text = ["<div style='text-shadow: none;'>"+firstRow+"</div>", 	//Dong chu thu nhat
				"<div style='text-shadow: none;'>"+secondRow+"</div>"];	//Dong chu thu hai
		style = ["#00CC00",		//Mau dong chu tieu de,
					"#FFFFFF",	//Mau dong chu chinh,
					"#000000",	//Mau nen tieu de,
					"#666666",	//Mau nen cua dong chu,
					"",			//Hinh nen duoi tieu de,
					"",			//Hinh nen duoi dong chu chinh,
					"",			//Vi tri cua tieu de,
					"",			//Vi tri cua dong chu chinh,
					"",			//Loai font tieu de,
					"",			//Loai font dong chu chinh,
					"",			//Tip Position,
					"",			//Kieu Sticky,
					3,			//Co font cua dong tieu de,
					3,			//Co font cua dong chu chinh,
					"",			//Chieu rong,
					"",			//Chieu cao,
					2,			//Co vien cua khung,
					2,			//PadTextArea,
					10,			//Toa do X,
					10,			//Toa do Y,
					"",			//Thong so chuyen tiep,
					"",			//Khoang thoi gian chuyen tiep,
					"",			//Muc trong suot,
					"",			//Kieu bong do,
					"#FFFFFFFF"];//Mau cua bong
		stm(text,style);
	}
</script>	
<?php
}
?>		 